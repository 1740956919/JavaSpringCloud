webpackJsonp([5],{555:function(e,t,a){a(628);var o=a(218)(a(574),a(610),"data-v-58590a4d",null);e.exports=o.exports},563:function(e,t,a){e.exports={default:a(564),__esModule:!0}},564:function(e,t,a){var o=a(24),s=o.JSON||(o.JSON={stringify:JSON.stringify});e.exports=function(e){return s.stringify.apply(s,arguments)}},574:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a(563),s=a.n(o);t.default={data:function(){var e=function(e,t,a){""===t.replace(/(^\s*)|(\s*$)/g,"")?a(new Error("请输入角色名称")):a()};return{loading:"",getDataUrl:this.$store.state.url+"webauth/role/ListRoles",addUrl:this.$store.state.url+"webauth/role/saveRole",editUrl:this.$store.state.url+"webauth/role/updateRole",delUrl:this.$store.state.url+"webauth/role/delRole",dataSize:0,tableData:[],pageNum:1,pageSize:10,buttonList:[],menuButtonList:[],getUserDataUrl:this.$store.state.url+"system/user/listUsers",getHasAssgin:this.$store.state.url+"webauth/role/getRoleAssginUserCurrentPage",userChange:this.$store.state.url+"webauth/role/changeRoleUser",dataSize2:0,tableData2:[],pageNum2:1,pageSize2:10,dialogUserAuthorize:!1,titleUserAuthorize:"",titleMenuAuthorize:"",formInline:{userName:""},formData:{},editInfoBefore2:{},selectId2:{},getMenuUrl:this.$store.state.url+"webauth/menu/getAllMenu",getMenuBtnList:this.$store.state.url+"webauth/menuBtn/getMenuBtnList",getHasBottonUrl:this.$store.state.url+"webauth/role/getRoleAssginMenuBtn",roleChangeUrl:this.$store.state.url+"webauth/role/changeRoleMenuBtn",dialogMenuAuthorize:!1,checkedIds:[],buttonTable:[],defalutChoosenBtn:[],checkedChoosenBtn:[],newChoosenBtn:[],hasChooseBotton:[],changeMenuBtn:[],menuData:[],chooseMenuId:"",defaultProps:{children:"children",label:"label",pageRoleCodes:""},dialogAdd:!1,dialogEdit:!1,formLabelWidth:"80px",delNum:"0",form:{roleName:"",remark:""},editList:{},editInfoBefore:{},selectId:{},rules:{roleName:[{required:!0,validator:e,trigger:"blur"}],remark:[]},arrayList:[],arrayMenu:{menuId:"",buttonId:""},menuCodeFlag:""}},watch:{pageNum:function(){this.getData()},pageSize:function(){this.getData()},pageNum2:function(){this.getData2()},pageSize2:function(){this.getData2()}},mounted:function(){this.$nextTick(function(){this.getData(),this.getButton()})},activated:function(){this.getButton()},methods:{openFullScreen:function(){this.loading=this.$loading({lock:!0,text:"操作中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},getButton:function(){var e=this;this.menuCode=this.$store.state.menuCode;var t=new URLSearchParams;t.append("USER_NAME",localStorage.getItem("ms_username")),t.append("MENU_CODE",this.menuCode),t.append("BUTTON_CODE",""),this.$axios.post(this.$store.state.getButtonUrl,t).then(function(t){0==t.data.code?e.menuButtonList=t.data.data:e.$message({showClose:!0,message:t.data.msg,type:"error"})})},chooseClick:function(e){"openAdd"==e?this.openAdd("form"):"openEdit"==e?this.openEdit("editPwd"):"del"==e?this.del():"menuAuthorize"==e?this.menuAuthorize():"userAuthorize"==e&&this.userAuthorize()},searchForm:function(){var e=new URLSearchParams;e.append("formData",s()({userName:this.formInline.userName})),this.formData=e,1!=this.pageNum?this.pageNum2=1:this.getData2()},resetForm:function(e){this.$refs[e].resetFields()},handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.pageNum=e},handleSizeChange2:function(e){this.pageSize2=e},handleCurrentChange2:function(e){this.pageNum2=e},chooseOne:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].roleCode);this.delNum=t.length,this.selectId=t.join(","),1==e.length?this.editInfoBefore=JSON.parse(s()(e[0])):this.editInfoBefore={}},chooseAll:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].roleCode);this.delNum=t.length,this.selectId=t.join(","),this.editInfoBefore={}},getData:function(){var e=this;this.openFullScreen(),this.$axios.post(this.getDataUrl+"?pageSize="+this.pageSize+"&pageNum="+this.pageNum).then(function(t){e.loading.close(),e.selectId={},e.editInfoBefore={},0==t.data.code?(e.tableData=t.data.data.list,e.dataSize=t.data.data.totalRecords):e.$message({showClose:!0,message:t.data.msg,type:"error"})})},openAdd:function(e){this.dialogAdd=!0,this.$refs[e]&&this.$refs[e].resetFields()},openEdit:function(){this.editInfoBefore&&void 0!==this.editInfoBefore.uuid?(this.dialogEdit=!0,this.editList=JSON.parse(s()(this.editInfoBefore))):this.$message({showClose:!0,message:"请选择一条数据进行修改",type:"error"})},del:function(){var e=this;void 0!=this.selectId.length&&0<this.selectId.length?this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=new URLSearchParams;t.append("roles",e.selectId),e.openFullScreen(),e.$axios.post(e.delUrl,t).then(function(t){e.loading.close(),0==t.data.code?(Number(e.dataSize)-Number(e.delNum)>Number(Number(e.pageNum)-1)*Number(e.pageSize)&&Number(e.pageNum)>1?e.getData():e.pageNum--,e.editList={},e.$message({type:"success",message:"删除成功!"})):e.$message({showClose:!0,message:t.data.msg,type:"error"})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})}):this.$message({showClose:!0,message:"请选择一条数据进行删除",type:"error"})},addSure:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=new URLSearchParams;a.append("roleName",t.form.roleName),a.append("remark",t.form.remark),t.openFullScreen(),t.$axios.post(t.addUrl,a).then(function(e){t.loading.close(),0==e.data.code?(t.getData(),t.$message({showClose:!0,message:"新增角色成功",type:"success"})):t.$message({showClose:!0,message:e.data.msg,type:"error"})}),t.dialogAdd=!1})},editSure:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=new URLSearchParams;a.append("roleName",t.editList.roleName),a.append("remark",t.editList.remark),a.append("roleCode",t.editList.roleCode),t.openFullScreen(),t.$axios.post(t.editUrl,a).then(function(e){t.loading.close(),0==e.data.code?(t.getData(),t.$message({showClose:!0,message:"修改成功",type:"success"})):t.$message({showClose:!0,message:e.data.msg,type:"error"})}),t.dialogEdit=!1})},menuAuthorize:function(){this.editInfoBefore&&void 0!==this.editInfoBefore.uuid?(this.buttonTable=[],this.titleMenuAuthorize=this.editInfoBefore.roleName,this.getMenuData(),this.getHasBotton(),this.dialogMenuAuthorize=!0):this.$message({showClose:!0,message:"请选择一个角色进行授权",type:"error"})},getHasBotton:function(){var e=this;this.defalutChoosenBtn=[];var t=new URLSearchParams;t.append("ROLE_CODE",this.editInfoBefore.roleCode),this.$axios.post(this.getHasBottonUrl,t).then(function(t){if(0==t.data.code)for(var a=0;a<t.data.data.checked.length;a++){var o={menuCode:t.data.data.checked[a].menuCode,buttonCode:t.data.data.checked[a].buttonCode};e.defalutChoosenBtn.push(o)}})},userAuthorize:function(){this.editInfoBefore&&void 0!==this.editInfoBefore.uuid?(this.titleUserAuthorize=this.editInfoBefore.roleName,this.getData2(),this.dialogUserAuthorize=!0):this.$message({showClose:!0,message:"请选择一个角色进行授权",type:"error"})},getUseHasChoose:function(){var e=this,t=[];this.pageRoleCodes="";for(var a=0;a<this.tableData2.length;a++)t.push(this.tableData2[a].userCode);this.pageRoleCodes=t.join(",");var o=new URLSearchParams;o.append("ROLE_CODE",this.editInfoBefore.roleCode),o.append("USER_CODES",this.pageRoleCodes),this.$axios.post(this.getHasAssgin,o).then(function(t){if(0==t.data.code){for(var a=[],o=0;o<t.data.data.length;o++)for(var s=0;s<e.tableData2.length;s++)t.data.data[o]==e.tableData2[s].userCode&&(e.$refs.multipleTable.toggleRowSelection(e.tableData2[s],!0),a.push(e.tableData2[s].userCode));e.selectId2=a.join(",")}})},chooseOne2:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].userCode);this.selectId2=t.join(",")},chooseAll2:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].userCode);this.selectId2=t.join(",")},getData2:function(){var e=this;this.$axios.post(this.getUserDataUrl+"?pageSize="+this.pageSize2+"&pageNum="+this.pageNum2,this.formData).then(function(t){if(e.editInfoBefore2={},e.selectId2={},0==t.data.code){e.tableData2=t.data.data.list;for(var a=0;a<e.tableData2.length;a++)0==e.tableData2[a].sex?e.tableData2[a].sex="女":e.tableData2[a].sex="男",0==e.tableData2[a].adminFlag?e.tableData2[a].adminFlag="否":e.tableData2[a].adminFlag="是";e.dataSize2=t.data.data.totalRecords,e.getUseHasChoose()}else e.$message({showClose:!0,message:t.data.msg,type:"error"})})},userAuthorizeSure:function(){var e=this,t=new URLSearchParams;t.append("role_code",this.editInfoBefore.roleCode),t.append("currUserCodes",this.pageRoleCodes),t.append("newUserCodes",this.selectId2),this.openFullScreen(),this.$axios.post(this.userChange,t).then(function(t){e.loading.close(),0==t.data.code&&(e.$message({showClose:!0,message:"用户授权成功",type:"success"}),e.dialogUserAuthorize=!1,e.getData())})},menuAuthorizeSure:function(){for(var e=this,t=this.$refs.tree1.getCheckedKeys(),a=this.$refs.tree1.getHalfCheckedNodes(),o=0;o<a.length;o++)t.push(a[o].id);this.newChoosenBtn=[];for(var s=0;s<this.defalutChoosenBtn.length;s++)for(var i=0;i<t.length;i++)if(this.defalutChoosenBtn[s].menuCode==t[i]){var n=this.defalutChoosenBtn[s].menuCode+":"+this.defalutChoosenBtn[s].buttonCode;this.newChoosenBtn.push(n)}var r=new URLSearchParams;r.append("ROLE_CODE",this.editInfoBefore.roleCode),r.append("MENU_CODES",t),r.append("MENU_BTNS",this.newChoosenBtn),this.openFullScreen(),this.$axios.post(this.roleChangeUrl,r).then(function(t){e.loading.close(),0==t.data.code?(e.$message({showClose:!0,message:"菜单授权成功",type:"success"}),e.dialogMenuAuthorize=!1,e.getData()):e.$message({showClose:!0,message:t.data.msg,type:"error"})})},handleNodeClick:function(e){this.chooseMenuId=e.id;for(var t=0;t<this.changeMenuBtn.length;t++)if(e.id==this.changeMenuBtn[t].id)return this.buttonTable=this.changeMenuBtn[t].buttons,void this.$nextTick(function(){this.setChoose(this.changeMenuBtn[t].select)});this.findButtonList()},handleCheckChange:function(e,t,a){},chooseOneBotton:function(e){for(var t=[],a=[],o=0;o<e.length;o++){var s={menuCode:e[o].menuCode,buttonCode:e[o].buttonCode};a.push(s),t.push(e[o].buttonCode)}for(var i=0;i<this.changeMenuBtn.length;i++)this.chooseMenuId==this.changeMenuBtn[i].id&&(this.changeMenuBtn[i].select=t);for(var n=0;n<this.defalutChoosenBtn.length;n++)this.defalutChoosenBtn[n].menuCode==this.chooseMenuId&&(this.defalutChoosenBtn.splice(n,1),n--);this.defalutChoosenBtn=this.defalutChoosenBtn.concat(a)},unique:function(e){for(var t=[],a=0,o=e.length;a<o;a++){for(var s=a+1;s<o;s++)e[a]===e[s]&&(s=++a);t.push(e[a])}return t},contains:function(e,t){for(var a=e.length;a--;)if(e[a]===t)return!0;return!1},findButtonList:function(){var e=this,t=new URLSearchParams;t.append("MENU_CODE",this.chooseMenuId),t.append("ROLE_CODE",this.editInfoBefore.roleCode),this.$axios.post(this.getMenuBtnList,t).then(function(t){if(0==t.data.code){e.buttonTable=t.data.data.all,e.hasChooseBotton=[];for(var a=0;a<t.data.data.checked.length;a++)e.hasChooseBotton.push(t.data.data.checked[a].buttonCode);e.$nextTick(function(){this.setChoose(this.hasChooseBotton)});var o={id:e.chooseMenuId,buttons:e.buttonTable,select:e.hasChooseBotton};e.changeMenuBtn.push(o)}else e.$message({showClose:!0,message:t.data.msg,type:"error"})})},getMenuData:function(){var e=this,t=new URLSearchParams;t.append("roleCode",this.editInfoBefore.roleCode),this.$axios.post(this.getMenuUrl,t).then(function(t){if(e.checkedIds=[],e.buttonList=[],e.changeMenuBtn=[],0==t.data.code){e.menuData=t.data.data.rootTree;for(var a=0;a<t.data.data.menuCodeList.length;a++)e.checkedIds.push(t.data.data.menuCodeList[a].menuCode)}else e.$message({showClose:!0,message:t.data.msg,type:"error"})})},cancelDialog:function(){this.dialogAdd=!1,this.dialogEdit=!1,this.dialogUserAuthorize=!1,this.dialogMenuAuthorize=!1},setChoose:function(e){for(var t=0;t<e.length;t++)for(var a=0;a<this.buttonTable.length;a++)e[t]==this.buttonTable[a].buttonCode&&this.$refs.multipleBtnTable.toggleRowSelection(this.buttonTable[a],!0)}}}},587:function(e,t,a){t=e.exports=a(95)(!1),t.push([e.i,".left[data-v-58590a4d]{float:left}.right[data-v-58590a4d]{float:right}.pad-rig-10[data-v-58590a4d]{padding-right:10px}.mar-top-20[data-v-58590a4d]{margin-top:20px}.menuTreeLeft[data-v-58590a4d]{width:30%;float:left}.menuTreeRight[data-v-58590a4d]{width:70%;float:right}.MenuTreeTitle[data-v-58590a4d]{border:1px solid #d1dbe5;border-bottom:none}.menuTreeNews[data-v-58590a4d],.MenuTreeTitle[data-v-58590a4d]{height:40px;line-height:40px;padding-left:10px;background:#fbfdff}.menuTreeNews[data-v-58590a4d]{border:1px solid #d1dbe5;border-left:none}.mar-top-10[data-v-58590a4d]{margin-top:10px}.el-form-item[data-v-58590a4d]{margin-bottom:20px}.buttonStyle[data-v-58590a4d]{border:1px solid #d1dbe5;padding:8px 12px;border-radius:4px}.inputWidth[data-v-58590a4d]{width:80%}",""])},610:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",e._l(e.menuButtonList,function(t,o){return a("el-button",{key:o,attrs:{type:"primary",icon:t.buttonStyle},on:{click:function(a){e.chooseClick(t.buttonUrl)}}},[e._v(e._s(t.buttonName))])})),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",height:"450"},on:{select:e.chooseOne,"select-all":e.chooseAll}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"roleName",label:"名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.dataSize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增角色",visible:e.dialogAdd,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogAdd=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"roleName"}},[a("el-input",{staticClass:"inputWidth",attrs:{clearable:""},model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注","label-width":e.formLabelWidth,prop:"remark"}},[a("el-input",{staticClass:"inputWidth",attrs:{clearable:""},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.cancelDialog()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addSure("form")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改角色",visible:e.dialogEdit,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogEdit=t}}},[a("el-form",{ref:"editList",attrs:{model:e.editList,rules:e.rules}},[a("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"roleName"}},[a("el-input",{staticClass:"inputWidth",attrs:{clearable:""},model:{value:e.editList.roleName,callback:function(t){e.$set(e.editList,"roleName",t)},expression:"editList.roleName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注","label-width":e.formLabelWidth,prop:"remark"}},[a("el-input",{staticClass:"inputWidth",attrs:{clearable:""},model:{value:e.editList.remark,callback:function(t){e.$set(e.editList,"remark",t)},expression:"editList.remark"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.cancelDialog()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editSure("editList")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"用户授权—"+e.titleUserAuthorize,visible:e.dialogUserAuthorize,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogUserAuthorize=t}}},[a("div",[a("el-form",{ref:"formInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-form-item",{attrs:{label:"用户名称",prop:"userName"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formInline.userName,callback:function(t){e.$set(e.formInline,"userName",t)},expression:"formInline.userName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.searchForm()}}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){e.resetForm("formInline")}}},[e._v("重置")])],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData2,border:"",stripe:"",height:"380"},on:{select:e.chooseOne2,"select-all":e.chooseAll2}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"用户名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sex",label:"性别"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"adminFlag",label:"是否管理员"}})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.pageNum2,"page-sizes":[10,20,50,100],"page-size":e.pageSize2,layout:"total, sizes, prev, pager, next, jumper",total:e.dataSize2},on:{"size-change":e.handleSizeChange2,"current-change":e.handleCurrentChange2}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.cancelDialog()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.userAuthorizeSure()}}},[e._v("授权")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"菜单授权-"+e.titleMenuAuthorize,visible:e.dialogMenuAuthorize,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogMenuAuthorize=t}}},[a("div",{staticClass:"menuTreeLeft"},[a("div",{staticClass:"MenuTreeTitle"},[a("div",{staticClass:"left"},[e._v("菜单")])]),e._v(" "),a("el-tree",{ref:"tree1",staticStyle:{height:"430px",overflow:"auto",border:"1px solid #d1dbe5"},attrs:{data:e.menuData,"default-expand-all":!0,"highlight-current":!0,"show-checkbox":"","node-key":"id","default-checked-keys":e.checkedIds,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),a("div",{staticClass:"menuTreeRight"},[a("div",{staticClass:"menuTreeNews"},[a("span",[e._v("菜单按钮")])]),e._v(" "),a("div",{},[a("div",[a("el-table",{ref:"multipleBtnTable",staticStyle:{width:"100%"},attrs:{data:e.buttonTable,border:"",stripe:"",height:"430"},on:{select:e.chooseOneBotton,"select-all":e.chooseOneBotton}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"buttonName",label:"按钮名称",sortable:""}})],1)],1)])]),e._v(" "),a("div",{staticStyle:{clear:"both"}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.cancelDialog()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.menuAuthorizeSure()}}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]}},628:function(e,t,a){var o=a(587);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(217)("69546452",o,!0)}});